<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>AnonyChat â€” Join</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Join or create an AnonyChat room" />
  <link rel="stylesheet" href="style.css">
</head>
<body class="join-body">
  <main class="join-card" role="main" aria-labelledby="joinTitle">
    <h1 id="joinTitle" class="join-title">AnonyChat</h1>

    <p class="join-sub">Enter a display name and a room code to create or join a room.</p>

    <form id="joinForm" class="join-form" autocomplete="off" novalidate>
      <label for="nameInput" class="visually-hidden">Display name</label>
      <input id="nameInput" name="name" type="text" placeholder="Your display name" maxlength="48" required aria-required="true">

      <label for="roomInput" class="visually-hidden">Room code</label>
      <input id="roomInput" name="room" type="text" placeholder="Room code (e.g. party123)" maxlength="64" required aria-required="true">

      <div class="join-actions">
        <button id="joinBtn" type="submit" class="btn-primary" aria-label="Join room">Join Room</button>
      </div>

      <p id="joinError" class="form-error" role="status" aria-live="polite" hidden></p>
    </form>

    <section class="join-help">
      <p class="join-note">Tip: Use a short code your friends can remember. Names appear in the room.</p>
    </section>
  </main>

  <script>
    (function () {
      const joinForm = document.getElementById('joinForm');
      const nameInput = document.getElementById('nameInput');
      const roomInput = document.getElementById('roomInput');
      const joinError = document.getElementById('joinError');

      // Autofill from localStorage if available
      try {
        const storedName = localStorage.getItem('anonychat_name');
        const storedRoom = localStorage.getItem('anonychat_room');
        if (storedName) nameInput.value = storedName;
        if (storedRoom) roomInput.value = storedRoom;
      } catch (e) { /* ignore storage errors */ }

      nameInput.focus();

      joinForm.addEventListener('submit', (e) => {
        e.preventDefault();
        joinError.hidden = true;
        const name = nameInput.value.trim();
        const room = roomInput.value.trim();

        if (!name || !room) {
          joinError.textContent = 'Please enter both a display name and a room code.';
          joinError.hidden = false;
          return;
        }

        try {
          localStorage.setItem('anonychat_name', name);
          localStorage.setItem('anonychat_room', room);
        } catch (err) { /* ignore */ }

        // Redirect to chat.html with params (chat will read from localStorage as fallback)
        const url = `chat.html?name=${encodeURIComponent(name)}&room=${encodeURIComponent(room)}`;
        window.location.href = url;
      });
    })();
  </script>
</body>
</html>
