<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Games | Anonychat</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col">

    <!-- Header -->
    <header id="siteHeader" class="p-4 bg-gray-800 text-center text-2xl font-bold">
        <a href="https://lobby.schooladminwebtesting.biz"
           class="inline-block w-[200px] h-[50px] bg-gradient-to-r from-blue-400 to-blue-600 text-white rounded-lg hover:opacity-90 transition flex items-center justify-center">
            AnonyChat
        </a>

       </a>
   <a href="https://lobby.schooladminwebtesting.biz/about"
           class="inline-block w-[200px] h-[50px] bg-gradient-to-r from-blue-400 to-blue-600 text-white rounded-lg hover:opacity-90 transition flex items-center justify-center">
            About
        </a>

        <h5>GAMES ARE PURELY MEANT FOR TIMES TEACHERS PERMIT, OR AT HOME FOR ENTERTAINMENT. I'M NOT RESPONSABLE FOR YOU GETTING IN TROUBLE.</h5>

        Games
    </header>

    <!-- Search -->
    <div class="p-4" id="searchWrapper">
        <input id="searchBar"
               type="text"
               placeholder="Search games..."
               class="w-full p-2 rounded text-black" />
    </div>

    <!-- Game Grid -->
    <main class="grid grid-cols-2 md:grid-cols-4 gap-6 p-4" id="gamesGrid">
        <!-- JS inserts game tiles -->
    </main>

    <p id="noResults" class="text-center text-gray-400 hidden">No games found.</p>

    <script>
        async function loadGames() {
            try {
                const res = await fetch("/game_uploads");
                const html = await res.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, "text/html");

                const files = Array.from(doc.querySelectorAll("a"))
                    .map(a => a.getAttribute("href"))
                    .filter(f => f.endsWith(".html"));

                const grid = document.getElementById("gamesGrid");
                grid.innerHTML = "";

                files.forEach(file => {
                    const name = file.replace(".html", "");
                    const tile = document.createElement("div");
                    tile.className = "bg-gray-800 rounded-xl shadow-lg overflow-hidden gameTile";
                    tile.setAttribute("data-name", name.toLowerCase());

                    tile.innerHTML = `
                        <img src="/game_uploads/images/${name}.jpg"
                             onerror="this.src='/game_uploads/images/${name}.jpeg'; this.onerror=null;"
                             alt="${name}"
                             class="w-full h-32 object-cover">
                        <div class="p-3 flex justify-between items-center">
                          <span class="font-semibold">${name}</span>
                          <button onclick="playGame('${file}')"
                                  class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded">
                            Play
                          </button>
                        </div>
                    `;
                    grid.appendChild(tile);
                });

                // Show header & search bar again
                document.getElementById("siteHeader").classList.remove("hidden");
                document.getElementById("searchWrapper").classList.remove("hidden");
                document.getElementById("noResults").classList.add("hidden");
            } catch (err) {
                console.error("Error loading games", err);
            }
        }

        function playGame(file) {
            const grid = document.getElementById("gamesGrid");
            const searchWrapper = document.getElementById("searchWrapper");
            const noResults = document.getElementById("noResults");
            const header = document.getElementById("siteHeader");

            // Hide header + search while game is open
            header.classList.add("hidden");
            searchWrapper.classList.add("hidden");

            grid.innerHTML = `
                <div class="relative w-screen h-screen">
                  <button onclick="loadGames()"
                    class="absolute top-4 left-4 bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded z-20">
                    ‚Üê Back
                  </button>
                  <iframe src="/game_uploads/${file}"
                          class="absolute top-0 left-0 w-screen h-screen border-0"></iframe>
                </div>
            `;
            noResults.classList.add("hidden");
        }

        document.getElementById("searchBar").addEventListener("input", function () {
            const query = this.value.toLowerCase();
            const tiles = document.querySelectorAll(".gameTile");
            let visibleCount = 0;

            tiles.forEach(tile => {
                const name = tile.getAttribute("data-name");
                if (name.includes(query)) {
                    tile.style.display = "block";
                    visibleCount++;
                } else {
                    tile.style.display = "none";
                }
            });

            document.getElementById("noResults").classList.toggle("hidden", visibleCount > 0);
        });

        loadGames();
    </script>
</body>
</html>
