<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AnonyChat Games</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center p-6">
  <h1 class="text-4xl font-bold mb-6">ðŸŽ® AnonyChat Games</h1>

  <!-- Game grid -->
  <div id="gameGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 w-full"></div>

  <!-- Game player -->
  <div id="gamePlayer" class="hidden relative w-full h-screen">
    <button id="backButton" class="absolute top-4 left-4 px-4 py-2 bg-gray-800 text-white rounded-lg shadow hover:bg-gray-700">â¬… Back</button>
    <iframe id="gameFrame" class="w-full h-full border-0"></iframe>
  </div>

  <script>
    async function loadGames() {
      const res = await fetch("/games/game_uploads");
      const text = await res.text();

      // Parse HTML directory listing
      const parser = new DOMParser();
      const doc = parser.parseFromString(text, "text/html");
      const links = [...doc.querySelectorAll("a")];

      const gameFiles = links
        .map(a => a.getAttribute("href"))
        .filter(f => f && f.endsWith(".html") && !f.includes("index.html"));

      const grid = document.getElementById("gameGrid");

      for (const file of gameFiles) {
        const name = file.replace(".html", "");
        const exts = ["jpg", "jpeg", "png"];
        let imgSrc = "";

        for (const ext of exts) {
          try {
            const check = await fetch(`/games/game_uploads/images/${name}.${ext}`);
            if (check.ok) {
              imgSrc = `/games/game_uploads/images/${name}.${ext}`;
              break;
            }
          } catch {}
        }

        const card = document.createElement("div");
        card.className = "bg-gray-800 rounded-xl shadow-lg p-4 flex flex-col items-center";

        card.innerHTML = `
          <img src="${imgSrc}" alt="${name}" class="w-full h-40 object-cover rounded-lg mb-3">
          <h2 class="text-lg font-semibold mb-2">${name}</h2>
          <button class="px-4 py-2 bg-blue-600 rounded-lg hover:bg-blue-500 transition">Play</button>
        `;

        card.querySelector("button").addEventListener("click", () => playGame(file));
        grid.appendChild(card);
      }
    }

    function playGame(file) {
      document.getElementById("gameGrid").classList.add("hidden");
      document.getElementById("gamePlayer").classList.remove("hidden");
      document.getElementById("gameFrame").src = `/games/game_uploads/${file}`;
    }

    document.getElementById("backButton").addEventListener("click", () => {
      document.getElementById("gameFrame").src = "";
      document.getElementById("gamePlayer").classList.add("hidden");
      document.getElementById("gameGrid").classList.remove("hidden");
    });

    loadGames();
  </script>
</body>
</html>
